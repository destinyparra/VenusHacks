<!DOCTYPE html>
<html>

<head>
    <title>Map View</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Leaflet CSS -->
    <!-- <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" /> -->
    <link rel="stylesheet" href="static/styles.css" />


    <style>
        #map {
            height: 500px;
            width: 100%;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }

        h1 {
            color: #2c3e50;
            text-align: center;
        }
    </style>
</head>

<body>
    <!-- <div class="container">
        <h1>Map View</h1>
        <div id="map"></div>
    </div> -->

    <div class="container">
        <h1>Map View</h1>
        <a href="{{ url_for('home') }}"
            style="display:inline-block;padding:10px 20px;background:#2c3e50;color:#fff;text-decoration:none;border-radius:5px;margin-bottom:20px;">Back
            to Home</a>
        <div id="map"></div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([33.645968217866574, -117.84270903384764], 16); // UCI campus
        var myIcon = L.icon({
            iconUrl: 'static/images/tampon_icon.png',
            iconSize: [40, 70],
            iconAnchor: [22, 94],
            popupAnchor: [-3, -76],
            // shadowUrl: 'my-icon-shadow.png',
            // shadowSize: [68, 95],
            // shadowAnchor: [22, 94]
        });
        var userIcon = L.icon({
            iconUrl: 'static/images/Woman_icon.png',
            iconSize: [30, 50],
            iconAnchor: [22, 94],
            popupAnchor: [-3, -76],
            // shadowUrl: 'my-icon-shadow.png',
            // shadowSize: [68, 95],
            // shadowAnchor: [22, 94]
        });

        // L.marker([50.505, 30.57], { icon: myIcon }).addTo(map);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);
        // L.marker([33.64252877591157, -117.84161569140684])
        //     .addTo(map)
        //     .bindPopup('UCI Campus')
        //     .openPopup();
        fetch('/static/bathrooms.json')
            .then(response => response.json())
            .then(data => {
                data.forEach(bathroom => {
                    L.marker([bathroom.latitude, bathroom.longitude], { icon: myIcon })
                        .addTo(map)
                        .bindPopup(`<strong>${bathroom.name}</strong><head>
</head>
<body>
    <a href="#popup" style="padding: 5px 10px; background-color: #007BFF; 
                            color: #fff; text-decoration: none; border-radius: 5px;">Details</a>
    <div id="popup" class="popup">
        <div class="popup-content">
            <h2>${bathroom.name}</h2>
            <p>${bathroom.availability}</p >
                        <a href="#" style="display: inline-block; margin-top: 10px; padding:
                               5px 10px; background-color: #c90076; color: #fff; text-decoration:
                               none; border-radius: 3px;">Close</a>
        </div >
    </div >
</body >`);
                });
            });
        // get users current location
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                var userLat = position.coords.latitude;
                var userLng = position.coords.longitude;
                L.marker([userLat, userLng], { icon: userIcon })
                    .addTo(map)
                    .bindPopup('You are here')
                    .openPopup();
                map.setView([userLat, userLng], 16);
            }, function () {
                alert('Geolocation failed. Please allow location access.');
            });
        } else {
            alert('Geolocation is not supported by this browser.');
        }
    </script>
</body>

</html>